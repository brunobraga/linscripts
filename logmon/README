Copyright (C) 2009 by Bruno Braga 

This file is part of the project Linscripts. More info at: 
http://code.google.com/p/linscripts/

"logmon.sh" comes with ABSOLUTELY NO WARRANTY.  This is free software, 
and you are welcome to redistribute it under certain conditions.  
See copyright information below for additional disclaimer. 

Copyright: 
----------

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

	    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or 
    implied. See the License for the specific language governing 
    permissions and limitations under the License.


Notes: This file is part of the project Linscripts. More info at:
    http://code.google.com/p/linscripts/

    Bugs, issues and requests are welcome at:
    http://code.google.com/p/linscripts/issues/list

Installation:
-------------

    This is a simple script that requires no specific installation, besides the
    basic that comes in practically every linux distribution. 
    
    For production basis usage, it is advised to place this script in a 
    directory with proper permission control.
    
    Eg. /usr/local/scripts/logmon/
    
Usage:
------
    
    Script that keeps constantly (same concept of tail+follow) monitoring 
    certain log file, and executes certain action informed in the arguments.

    Arguments:
    ----------
      [exec]      the action(s) to be taken upon new entries in logfile,
                  being transferred by piping (eg. send email, notify external 
                  source, etc). See example. This argument is mandatory.
                  The custom values can dynamically added to the action script:
                        __APP__: this script name
                        __LOG__: the log file being monitored (complete path)
                        __SRC__: the source information being logged in file 

      [logfile]   the log file to be monitored. It should be a syslog
                  formatted file, or this script may not work properly.
                  If not informed, the default used will be 
                  "/var/log/syslog" file.
    Options:
    --------
      -i  --ignore      the regular expression (egrep) containing the matches to 
                        be ignored by this script. Add here any keywords or 
                        patterns you want the script to skip the `--exec` 
                        action.
                        
      -h, --help        prints this help information
      
      -v, --verbose     more detailed data of what is going on, in case this 
                        script is not running as daemon
                        
          --version     prints the version of this script

    Examples:
    ---------
        # using `mail` for sending alarms by email
        ./logmon.sh --ignore "^test$|/usr/sbin/cron|^init$" \
                    --verbose \
                    "mail bruno.braga@gmail.com \
                         -s \"__APP__ Alarm [$HOSTNAME]: __LOG__ __SRC__\"" \
                    /var/log/syslog
                
        
        # using `sendEmail` for sending alarms by email (external mail server)
        ./logmon.sh --ignore "^test$|/usr/sbin/cron|^init$" \
                    --verbose \
                    "sendEmail -q \
                         -s localhost \
                         -f bruno.braga@localhost \
                         -t bruno.braga@gmail.com \
                         -u \"__APP__ Alarm [$HOSTNAME]: __LOG__ __SRC__\"" \
                    /var/log/syslog

    Additional Info:
    ----------------
    
        (1) You may run multiple instances (processes) of this script without
            any problems, as long as they are not monitoring the same log file.
            (this will create a lock file in /tmp/ folder to avoid this)
            
        (2) It is advised to run this as a background process, but you may 
            leave running on screen and verbose mode for 
            tracking/troubleshooting purposes.
            Suggestion: add your script call to /etc/rc.local file to allow it
                        to run on startup.
    
        
